<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
<script type = "text/javascript" language ="javascript">
var mqtt;
var reconnectTimeout = 2000;
var host ="broker.hivemq.com";
var port=8000;

// Connecting to the topics of different teams. 
function onConnect() {
    console.log("Connected");
    mqtt.subscribe("/gti780a2021alerts/#");
}

// Applying the right alert color to the table.
function onMessageArrived(msg){
    let table = document.getElementById("alerte");
    let teamName = msg.destinationName.substring(19,27);
    if(document.getElementById(teamName) == null){
        var row = table.insertRow(1);
        var team = row.insertCell(0);
        var color = row.insertCell(1);
        team.innerHTML = teamName;
        color.id = teamName;
        color.style.backgroundColor = "rgb(" + msg.payloadString.replaceAll(';',',') +')';
    }else{
        document.getElementById(teamName).style.backgroundColor = "rgb(" + msg.payloadString.replaceAll(';',',') +')';
    }
}

// Connecting to MQTT
function MQTTconnect(){
    console.log("connection to " + host +" " + port);
    mqtt = new Paho.MQTT.Client(host,port,"clientjs")
    var options = {
        timeout: 3,
        onSuccess: onConnect,
    };
    mqtt.onMessageArrived = onMessageArrived
    mqtt.connect(options);
}
</script>
<style>
    td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}
</style>
<h1>Laboratoire 2 (GTI780 - volet applicatif)</h1>
<script>
    MQTTconnect();
</script>
<h3>Mes capteurs</h3>
<table>
    <tr>
      <th>Timestamp</th>
      <th>Temperature</th>
      <th>Humidité</th>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </table>

  <h3>Système d'alerte</h3>
<table id="alerte">
    <tr>
      <th>Équipe</th>
      <th>Couleur</th>
    </tr>
  </table>